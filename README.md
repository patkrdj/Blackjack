# 블랙잭 게임

본 프로젝트는 다양한 블랙잭 전략의 승률을 검증하는 시뮬레이션 엔진이다. 
기본적인 대화형 게임 플레이를 지원함은 물론, 
사용자가 직접 설계한 전략(카드 카운팅, 베팅 시스템 등)을 기반으로 대규모 시뮬레이션을 수행하여 기대 수익률과 승률을 통계적으로 분석할 수 있다.

## 게임 규칙

### 기본 규칙
- 딜러와 플레이어는 카드의 합이 21에 가까운 값을 만들어야 한다.
- 카드 합이 21을 초과하면 즉시 패배(버스트)한다.
- 처음 두 장의 카드 합이 정확히 21이면 블랙잭이다.

### 카드 점수 계산
- 숫자 카드(2~10): 카드에 표시된 숫자 그대로 계산한다.
- J, Q, K: 각 10점으로 계산한다.
- Ace: 1점 또는 11점으로 계산한다.

### 플레이어 규칙
- 게임 시작 시 배팅 금액을 설정해야 한다.
- 처음 두 장의 카드를 받은 후 다음 행동을 결정할 수 있다.
  - Hit: 카드를 한 장 더 받는다.
  - Stand: 현재 카드로 승부를 겨룬다.
- 21을 넘지 않는 한 원하는 만큼 카드를 받을 수 있다.

### 딜러 규칙
- 카드 합이 16 이하면 반드시 카드를 한 장 더 받아야 한다.
- 카드 합이 17 이상이면 더 이상 카드를 받을 수 없다.

### 승패 및 배당
- 블랙잭: 처음 두 장의 합이 21인 경우, 배팅 금액의 1.5배를 획득한다.
- 일반 승리: 딜러보다 21에 가까운 경우, 배팅 금액의 1배를 획득한다.
- 무승부: 딜러와 금액이 같은 경우, 배팅 금액을 돌려받는다.
- 패배: 딜러보다 점수가 낮거나 버스트한 경우, 배팅 금액을 잃는다.

## 기능 요구사항

### 대화형 게임 플레이

1. 게임 초기화
    - [x] 🔴 [MUST] 베팅 금액 설정하여야 합니다.
    - [x] 🔴 [MUST] 카드 덱 생성을 생성해야 합니다.
    - [ ] 🟢 [MAY] 플레이어의 이름을 입력받는다.

2. 카드 배분
    - [x] 🔴 [MUST] 게임 시작 시 딜러와 플레이어에게 각각 2장씩 카드를 배분하여야 한다.
    - [x] 🔴 [MUST] 딜러의 카드 중 하나는 비공개로 하여야 한다.

3. 플레이어 턴
    - [x] 🔴 [MUST] Hit 혹은 Stand 입력을 받아야 한다.
    - [x] 🔴 [MUST] 카드 추가 시 점수 계산 및 버스트인지 확인해야 합니다.
    - [x] 🔴 [MUST] 현재 카드 상태를 출력해야 합니다.

4. 딜러 턴
    - [x] 🔴 [MUST] 딜러 규칙에 따라 자동으로 진행되어야 한다.

5. 승패 판정
    - [x] 🔴 [MUST] 플레이어와 딜러 간의 점수를 비교해야 한다.
    - [x] 🔴 [MUST] 승패 결과를 출력하여야 한다.
    - [x] 🔴 [MUST] 배팅 금액에 따른 결과를 정산해야 한다.
    - [x] 🟡 [SHOULD] 게임 통계 결과를 출력해야 한다.

### 게임 시뮬레이터

1. 전략 작성
    - [x] 🔴 [MUST] 사용자는 `Strategy` 인터페이스를 구현하여 자신만의 행동 규칙을 정의해야 한다.
    - [x] 🔴 [MUST] 전략 결정 시 필요한 게임 상태 정보(내 카드, 딜러의 오픈 카드, 남은 덱의 카운팅 정보)가 제공되어야 한다.
    - [ ] 🟡 [SHOULD] 작성하는 사용자가 이해하기 쉽게 변수를 쉽게 사용할 수 있게 해야 한다.

2. 시뮬레이션 실행
    - [x] 🔴 [MUST] 사용자는 시뮬레이션 횟수와 시드 금액을 설정해야 한다.
    - [x] 🔴 [MUST] 시뮬레이션은 Goroutine을 사용하여 병렬로 처리되어야 한다.
    - [ ] 🟢 [MAY] 병렬 처리 시 성능 저하를 막기 위해 전역 `math/rand` 대신 각 Goroutine 별로 독립된 `rand.Source`을 사용한다.

3. 결과 출력
    - [x] 🔴 [MUST] 승률과 같은 시뮬레이션 결과를 출력해야 한다.
    - [x] 🟢 [MAY] 시뮬레이션 소요 시간과 초당 처리 횟수를 출력하여 성능을 확인한다.

#### 추가 확장 기능
- [ ] 여러 플레이어가 참가할 수 있도록 한다.
- [ ] Split, Double Down 등의 추가 규칙을 구현한다.
- [ ] GUI를 제공한다.

## 시뮬레이션 결과
### 조건
시뮬레이션 횟수 : 1,000,000  
한 게임 당 라운드 횟수 : 10  
최소 베팅 : 1,000  
여기서 말하는 MyStrategy는 Edward O.Thorp의 블랙잭 전략을 따름.

### 시뮬레이션 결과
|            | DealerStrategy |  MyStrategy |
|------------|---------------:|------------:|
| Wins       |        4124838 |     4359181 |
| Losses     |         987298 |      886535 |
| Draws      |        4887864 |     4754284 |
| Total Bet  |    10000000000 | 26411873000 |
| Total Earn |     -531896500 |  -293066500 |
| Win Rate   |         41.25% |      43.59% |
| Return     |         -5.32% |      -1.11% |

### Goroutine 사용 벤치마킹
DealerStrategy를 실행시킨 결과

|            | Goroutine | For Iteration | Speedup |
|-----------:|----------:|--------------:|--------:|
|  1'000'000 |     8.80s |        13.69s |    1.56 |
|  5'000'000 |    30.30s |        69.41s |    2.29 |
| 10'000'000 |    63.81s |       144.81s |    2.27 |

### 결론
Split과 Double Down 기능이 구현되지 않아 카드 카운팅을 함아도 수익률이 -1.11%로 낮을 것을 볼 수 있다.
하지만 딜러의 전략을 그대로 사용할 경우는 -5.32%로 매우 낮은 수익률을 보이고 있어, 
카드 카운팅의 전략을 따르는 경우 딜러의 규칙을 그대로 따라서 하는 것보다는 4.21%의 성능 향상을 보이고 있다.

또한 Goroutine을 사용할 시 10'000'000회의 시뮬레이션을 돌릴 때 1분 정도의 시간 밖에 들지않았다.
이는 일반적인 For iteration을 돌렸을 때보다 약 2배 이상의 성능 향상을 얻을 수 있었다.

